@import helper._
@import models.entities.KbjCategory
@(kbjFatherCates: List[KbjCategory])
@implicitFieldConstructor = @{
  b3.horizontal.fieldConstructor("col-md-2", "col-md-3")
}

@views.html.manage.manageMain() {
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2" >
      @views.html.manage.leftMenu.render
      </div><!--col-md-2 -->
      <div class="col-md-10">
          <!--画面内容-->
        <div class="content-box-large min-height">
          <h2>品类映射</h2>
          <input type="hidden" id="menu" value="23">
          <div class="content-box-large">
            <div class="panel-body">
              <h4>选择可比价分类</h4>
              <div class="row">
                <div class="form-group col-sm-5">
                  <label class="col-sm-3 control-label">
                    父分类
                  </label>
                  <div class="col-sm-8">
                    <select class="form-control col-3" id="cate-root" onchange="createSelect()">
                      <option value="0">---请选择父分类---</option>
                      @for(kbjFatherCate <- kbjFatherCates) {
                        <option value="@kbjFatherCate.id">@kbjFatherCate.name</option>
                      }
                    </select>
                  </div>
                </div>
                <div class="form-group col-sm-5">
                  <label class="col-sm-3 control-label">
                    子分类
                  </label>
                  <div class="col-sm-8">
                    <select class="form-control col-3" id="cate-leaf" onchange="createLeafSelect()">
                      <option value="0"></option>
                    </select>
                  </div>
                </div>
                <button type="button" id="kbjConfirm" class="col-sm-1 btn btn-primary" disabled="disabled">确定</button>
              </div>
            </div>
          </div>
        </div><!--content-box-large-->
      </div><!--col-md-10 -->
    </div><!--row-->
  </div><!--container-fluid-->
}

  <script type="text/javascript">
    function createSelect() {
      var cateRootId = $("#cate-root option:selected").val();
//      alert(cateFatherId);
      if (cateRootId != 0) {
        $.ajax({
          type: "get",
          url: "/manage/cate/map/getleafcate/" + cateRootId,
          dataType: "json",
          success: function(data) {
            $("#cate-leaf").empty();
            $("#cate-leaf").append("<option value = '0'>---请选择子分类---</option>");

            for(var i = 0; i < data.length; i++ ) {
              $("#cate-leaf").append("<option value = " + data[i].id + ">" + data[i].name + "</option>");
            }
          },
          error: function() {
            alert(2);
          }
        })
      } else {
        $("#cate-leaf").empty();
        $("#cate-leaf").append("<option value = '0'></option>");
        $("#kbjConfirm").attr("disabled", "disabled");
      }
    }
    
    function createLeafSelect() {
      var cateLeafId = $("#cate-leaf").val();
      if (cateLeafId != 0) {
        $("#kbjConfirm").removeAttr("disabled");
      } else {
        $("#kbjConfirm").attr("disabled", "disabled");
      }
    }
  </script>